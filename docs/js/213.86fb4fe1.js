"use strict";(self["webpackChunktodo_buudienxatulap"]=self["webpackChunktodo_buudienxatulap"]||[]).push([[213],{4026:(e,n,o)=>{o.d(n,{Z:()=>p});var a=o(9835),t=o(6970);const s={class:"text-bold text-subtitle1"};function i(e,n,o,i,l,h){const d=(0,a.up)("q-banner");return(0,a.wg)(),(0,a.j4)(d,{dense:"","inline-actions":"",class:(0,t.C_)([o.bgcolor,"list-header text-white text-center"])},{default:(0,a.w5)((()=>[(0,a._)("span",s,[(0,a.WI)(e.$slots,"default")])])),_:3},8,["class"])}const l={props:["bgcolor"]};var h=o(1639),d=o(7128),u=o(9984),c=o.n(u);const r=(0,h.Z)(l,[["render",i]]),p=r;c()(l,"components",{QBanner:d.Z})},8213:(e,n,o)=>{o.r(n),o.d(n,{default:()=>U});var a=o(9835),t=o(6970),s=o(1957);const i={class:"q-pa-md"},l={class:"q-gutter-y-md column"},h=["href"],d={class:"text-h6"},u={class:"row items-center justify-end"};function c(e,n,o,c,r,p){const g=(0,a.up)("q-btn"),m=(0,a.up)("ListHeader"),T=(0,a.up)("q-icon"),w=(0,a.up)("q-input"),C=(0,a.up)("q-item-label"),k=(0,a.up)("q-item-section"),y=(0,a.up)("q-item"),D=(0,a.up)("q-separator"),N=(0,a.up)("q-list"),f=(0,a.up)("q-card-section"),v=(0,a.up)("q-date"),H=(0,a.up)("q-popup-proxy"),V=(0,a.up)("q-card"),I=(0,a.up)("q-dialog"),W=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(m,{bgcolor:"bg-orange-4"},{default:(0,a.w5)((()=>[(0,a.Uk)("KHL cước "+(0,t.zw)((e.doanhThu-e.tongCuocDaThanhToan).toLocaleString())+"đ : "+(0,t.zw)(e.tongCuocDaThanhToan.toLocaleString())+"đ / "+(0,t.zw)(e.doanhThu.toLocaleString())+"đ / "+(0,t.zw)(e.tongSoBuuGui)+" bưu gửi ",1),(0,a.Wm)(g,{rounded:"",color:"primary",onClick:n[0]||(n[0]=n=>e.copySoDienThoaiToClipboard()),icon:"content_copy"})])),_:1}),(0,a._)("div",l,[(0,a.Wm)(w,{outlined:"",modelValue:e.searchText,"onUpdate:modelValue":n[2]||(n[2]=n=>e.searchText=n),placeholder:"Từ khóa",hint:"Tháng tra cứu",onKeyup:n[3]||(n[3]=(0,s.D2)((n=>e.traCuu()),["enter"])),dense:""},{append:(0,a.w5)((()=>[""!==e.searchText?((0,a.wg)(),(0,a.j4)(T,{key:0,name:"close",onClick:n[1]||(n[1]=n=>e.searchText=""),class:"cursor-pointer"})):(0,a.kq)("",!0),(0,a.Wm)(T,{name:"search"})])),_:1},8,["modelValue"])]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.khls.sort((function(e,n){return n.soLuong-e.soLuong})),(n=>((0,a.wg)(),(0,a.j4)(N,{key:n.senderPhone},{default:(0,a.w5)((()=>[(0,a.Wm)(y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(n.senderName),1)])),_:2},1024),(0,a.Wm)(C,{caption:"",lines:"2"},{default:(0,a.w5)((()=>[(0,a._)("a",{href:`tel:${n.senderPhone}`},(0,t.zw)(n.senderPhone),9,h)])),_:2},1024),(0,a.Wm)(C,{caption:"",lines:"2"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(n.senderAdd),1)])),_:2},1024)])),_:2},1024),(0,a.Wm)(k,{side:"",top:""},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,t.zw)(n.soLuong),1)])),_:2},1024),(0,a.Wm)(T,{name:"access_time",onClick:o=>e.showKHL(n.senderPhone)},null,8,["onClick"]),(0,a.Wm)(C,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("COD: "+(0,t.zw)(parseInt(n.tongCOD).toLocaleString()),1)])),_:2},1024),(0,a.Wm)(C,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("Cước: "+(0,t.zw)(parseInt(n.tongCuoc).toLocaleString()),1)])),_:2},1024),(0,a.Wm)(C,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("Đã trừ cước: "+(0,t.zw)(e.tongSoTienBuTruCongNoDaTru(n.senderPhone)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,a.Wm)(D,{spaced:"",inset:""})])),_:2},1024)))),128)),(0,a.Wm)(I,{modelValue:e.showDialog,"onUpdate:modelValue":n[16]||(n[16]=n=>e.showDialog=n),"full-height":""},{default:(0,a.w5)((()=>[(0,a.Wm)(V,{class:"column full-height"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a._)("div",d,(0,t.zw)(e.khl.hoTen)+" - "+(0,t.zw)(e.khl.soDienThoai),1)])),_:1}),(0,a.Wm)(f,{class:"col q-pt-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{modelValue:e.khl.hoTen,"onUpdate:modelValue":n[4]||(n[4]=n=>e.khl.hoTen=n),label:"Họ và tên"},null,8,["modelValue"]),(0,a.Wm)(w,{modelValue:e.khl.maCRM,"onUpdate:modelValue":n[6]||(n[6]=n=>e.khl.maCRM=n),label:"Mã CRM"},{append:(0,a.w5)((()=>[(0,a.Wm)(T,{name:"content_copy",onClick:n[5]||(n[5]=n=>e.copyTextDienThoaiToClipboard(e.khl.maCRM))})])),_:1},8,["modelValue"]),(0,a.Wm)(w,{modelValue:e.khl.hopDong,"onUpdate:modelValue":n[7]||(n[7]=n=>e.khl.hopDong=n),label:"Hợp đồng DVBC"},null,8,["modelValue"]),(0,a.Wm)(w,{modelValue:e.khl.ngayHopDong,"onUpdate:modelValue":n[9]||(n[9]=n=>e.khl.ngayHopDong=n),label:"Ngày hợp đồng",mask:"date",rules:["date"],dense:e.dense},{append:(0,a.w5)((()=>[(0,a.Wm)(T,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(H,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(v,{modelValue:e.khl.ngayHopDong,"onUpdate:modelValue":n[8]||(n[8]=n=>e.khl.ngayHopDong=n)},{default:(0,a.w5)((()=>[(0,a._)("div",u,[(0,a.wy)((0,a.Wm)(g,{label:"Đóng",color:"primary",flat:"",dense:e.dense},null,8,["dense"]),[[W]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","dense"]),(0,a.Wm)(w,{modelValue:e.khl.tenNguoiHuong,"onUpdate:modelValue":n[10]||(n[10]=n=>e.khl.tenNguoiHuong=n),label:"Tên người hưởng",dense:e.dense},null,8,["modelValue","dense"]),(0,a.Wm)(w,{modelValue:e.khl.soTaiKhoanNganHang,"onUpdate:modelValue":n[11]||(n[11]=n=>e.khl.soTaiKhoanNganHang=n),label:"Số tài khoản ngân hàng",dense:e.dense},null,8,["modelValue","dense"]),(0,a.Wm)(w,{modelValue:e.khl.tenNganHang,"onUpdate:modelValue":n[12]||(n[12]=n=>e.khl.tenNganHang=n),label:"Tên ngân hàng",dense:e.dense},null,8,["modelValue","dense"]),(0,a.Wm)(w,{modelValue:e.khl.soTienBuTruCongNo,"onUpdate:modelValue":n[13]||(n[13]=n=>e.khl.soTienBuTruCongNo=n),label:"Số tiền trừ công nợ",dense:e.dense},null,8,["modelValue","dense"]),(0,a.Wm)(w,{modelValue:e.khl.soTienCODvePaypost,"onUpdate:modelValue":n[15]||(n[15]=n=>e.khl.soTienCODvePaypost=n),label:"Số tiền COD về Paypost",dense:e.dense},{after:(0,a.w5)((()=>[(0,a.Wm)(g,{round:"",dense:"",flat:"",icon:"send",onClick:n[14]||(n[14]=n=>e.updateKHL(e.khl))})])),_:1},8,["modelValue","dense"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}o(702),o(8964),o(2809);var r=o(9981),p=o.n(r),g=o(6827),m=o(6950),T=o(8359),w=o(4026);const C=(0,a.aZ)({components:{ListHeader:w.Z},name:"KHLPage",data(){const[e,n,o]=(new Date).toISOString().slice(0,10).split("-");return{ngayLamViec:[e,n,o].join("/"),showDialog:!1,ngay:o,thang:n,nam:e,searchText:[n,e].join("/"),tokenFe:"eyJhbGciOiJIUzUxMiJ9.eyJpc3MiOiJKRmNhcC1XZWJBcGkiLCJleHAiOjE2NzkzOTM2MTQsIm5iZiI6MTY3ODc4ODUxNCwiaWF0IjoxNjc4Nzg4NTE0LCJhaWQiOiJLSEwiLCJ1aWQiOiIxNDIwMTBfVEhBTUhUIiwidWZuIjoiSOG7kyBUaOG7iyBUaOG6r20iLCJvcmciOiIxNDIwMTAiLCJvcmdFbXBsIjoiMTQyMDEwIiwiZGlkIjoiZWRkNjJlZWFhZGVjYjBiNjM1NDI4ODY3YjJlZDEwMGIiLCJsY3AiOjE2MzU4MTY3NDIwMDAsImV4cGlyYXRpb25EYXRlIjo5MH0.pEQagaUmtO98vcaJu9v4ZAgCKJoPN0v98ctFIUliZnsVMl7eYYqxY1xbXUuGr6JbIf5So-a52LEEp8MGqBd_VA",dsDonHang:[],khls:[],tongSoBuuGui:0,doanhThu:0,tongCuocDaThanhToan:0,khl:{hoTen:"Nguyễn Văn Thìn",soDienThoai:"0978333963",hopDong:"Mlinh-191022-622000",ngayHopDong:"2022/10/19",soTienCODvePaypost:4e6,soTienBuTruCongNo:77500,tenNguoiHuong:"Nguyễn Văn Thìn",soTaiKhoanNganHang:"1618081988",tenNganHang:"MB",maCRM:"14200A04000622000"},cods:[],allCods:[]}},methods:{sleep(){return new Promise((e=>setTimeout(e,1500)))},async login(){var e=JSON.stringify({username:"142010_THAMHT",password:"Abc@123456789",ip:"",random:.8677049060452371}),n={method:"post",maxBodyLength:1/0,url:"https://api-portalkhl.vnpost.vn/api/auth/signinKhl",headers:{capikey:"19001235","Content-Type":"application/json"},data:e};const{data:{tokenFe:o}}=await p().post("https://api-portalkhl.vnpost.vn/api/auth/signinKhl",e,n);this.tokenFe=o},async loadData(){this.dsDonHang=[],this.tokenFe||await this.login();var e=JSON.stringify({orgCode:"142010",tuNgay:[1,parseInt(this.thang),this.nam].join("/"),denNgay:new Date(this.nam,parseInt(this.thang),1).toISOString().slice(0,10).split("-").reverse().join("/"),pageNum:0,pageSize:5e3,sourceSystem:"KHL"}),n={method:"post",maxBodyLength:1/0,url:"https://api-portalkhl.vnpost.vn/khl/getItemDtl",headers:{Authorization:`Bearer ${this.tokenFe}`,"Content-Type":"application/json"},data:e};m.Z.show({spinner:T.Z,spinnerSize:"100px"});const{data:[o,a]}=await p()(n);this.tongSoBuuGui=o,this.doanhThu=a.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0),m.Z.hide(),this.dsDonHang=a;const t=new Map,s=a.map((({senderPhone:e,senderName:n,senderAdd:o})=>({senderPhone:e,senderName:n,senderAdd:o})));for(let i=0;i<s.length;i++){const e=s[i];if(!t.has(e.senderPhone)){const n=a.filter((n=>n.senderPhone===e.senderPhone));t.set(e.senderPhone,{...e,soLuong:n.length,tongCuoc:n.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0),tongCOD:n.filter((e=>e.codAmount)).reduce(((e,{codAmount:n})=>e+parseInt(n)),0)})}}this.khls=[...t.values()]},async traCuu(){const[e,n]=this.searchText.split("/");this.thang=e,this.nam=n,this.loadData()},async findItems(e){return this.dsDonHang.filter((n=>n.senderPhone===e))},async tongCuoc(e){return e.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0)},async tongSoTienBuTruCongNo(e){const n=await this.tongCuoc(await this.findItems(e))-this.cods.reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0);return parseInt(n).toLocaleString()},tongSoTienBuTruCongNoDaTru(e){const n=this.allCods.filter((n=>n.soDienThoai==e)).reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0);return parseInt(n).toLocaleString()},async updateKHL({soDienThoai:e,hoTen:n,hopDong:o,ngayHopDong:a,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:i,maCRM:l,soTienCODvePaypost:h,soTienBuTruCongNo:d}){await p().post("https://192.168.1.7:2024/api/cods",{soDienThoai:e,hoTen:n,hopDong:o,ngayHopDong:a,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:i,maCRM:l,soTienCODvePaypost:h.replaceAll(".",""),soTienBuTruCongNo:d.replaceAll(".",""),ngayLamViec:this.ngayLamViec}),await p().put(`https://192.168.1.7:2024/api/khls/${e}`,{hoTen:n,hopDong:o,ngayHopDong:a,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:i,maCRM:l}),this.showDialog=!1},async loadKHL(e){const{data:n}=await p().get(`https://192.168.1.7:2024/api/khls/${e}`);this.khl=n},async loadCods(e){const{data:n}=await p().get(`https://192.168.1.7:2024/api/cods?name=${e}`);this.cods=n},async loadAllCods(){const{data:e}=await p().get("https://192.168.1.7:2024/api/cods");this.allCods=e,this.tongCuocDaThanhToan=this.allCods.reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0)},async showKHL(e){await this.loadCods(e),await this.loadKHL(e),this.khl.soTienBuTruCongNo=await this.tongSoTienBuTruCongNo(e);const n=this.cods.find((n=>n.soDienThoai===e&&new Date(n.ngayLamViec).toISOString().slice(0,10)===(new Date).toISOString().slice(0,10)));n&&(this.khl.soTienCODvePaypost=parseInt(n.soTienCODvePaypost).toLocaleString()),this.showDialog=!0},copyTextToClipboard(e){navigator.clipboard.writeText(`Để theo dõi định vị bưu gửi https://www.hotham.vn/tra-cuu-hang-buu-dien?q=${e}. (Bạn chỉ cần bấm vào link)`).then((function(){g.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){g.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},copySoDienThoaiToClipboard(){navigator.clipboard.writeText(this.khls.map((e=>e.senderPhone)).join()).then((function(){g.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){g.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},copyTextDienThoaiToClipboard(e){navigator.clipboard.writeText(e).then((function(){g.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){g.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},async khoiTao(){await this.loadAllCods(),await this.loadData()}},mounted(){this.khoiTao()}});var k=o(1639),y=o(4455),D=o(361),N=o(2857),f=o(2765),v=o(7088),H=o(3246),V=o(490),I=o(1233),W=o(3115),b=o(2218),S=o(2074),Z=o(4458),L=o(3190),_=o(1821),B=o(2146),O=o(9984),x=o.n(O);const M=(0,k.Z)(C,[["render",c]]),U=M;x()(C,"components",{QBtn:y.Z,QInput:D.Z,QIcon:N.Z,QPopupProxy:f.Z,QDate:v.Z,QList:H.Z,QItem:V.Z,QItemSection:I.Z,QItemLabel:W.Z,QSeparator:b.Z,QDialog:S.Z,QCard:Z.Z,QCardSection:L.Z,QCardActions:_.Z}),x()(C,"directives",{ClosePopup:B.Z})}}]);