"use strict";(globalThis["webpackChunktodolist"]=globalThis["webpackChunktodolist"]||[]).push([[535],{9535:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Z});var n=a(1758),i=a(9104),l=a(8790);const s={class:"row"},o={class:"col-6"},h={class:"col-4"},u={class:"col-2 text-right"},c=(0,n.Lk)("br",null,null,-1),r=(0,n.Lk)("br",null,null,-1),d=(0,n.Lk)("br",null,null,-1),g=(0,n.Lk)("br",null,null,-1);function m(e,t,a,m,T,p){const b=(0,n.g2)("q-icon"),k=(0,n.g2)("q-input"),B=(0,n.g2)("q-select"),y=(0,n.g2)("q-item-section"),H=(0,n.g2)("q-item"),f=(0,n.g2)("q-separator"),X=(0,n.g2)("q-list"),C=(0,n.g2)("q-menu"),D=(0,n.g2)("q-card-section"),v=(0,n.g2)("q-expansion-item"),_=(0,n.g2)("ThongTinTheBHYT"),x=(0,n.g2)("q-card"),W=(0,n.g2)("BhytUpdateDialog"),S=(0,n.g2)("q-dialog"),F=(0,n.g2)("q-page"),N=(0,n.gN)("close-popup");return(0,n.uX)(),(0,n.Wv)(F,{padding:""},{default:(0,n.k6)((()=>[(0,n.bF)(x,null,{default:(0,n.k6)((()=>[(0,n.bF)(D,null,{default:(0,n.k6)((()=>[(0,n.Lk)("div",s,[(0,n.Lk)("div",o,[(0,n.bF)(k,{label:"Tìm kiếm",outlined:"",modelValue:p.searchText,"onUpdate:modelValue":t[1]||(t[1]=e=>p.searchText=e),debounce:"900",ref:"inputSearch",onKeyup:t[2]||(t[2]=(0,i.jR)((e=>p.timKiem(p.searchText)),["enter"])),dense:""},{append:(0,n.k6)((()=>[""===p.searchText?((0,n.uX)(),(0,n.Wv)(b,{key:0,name:"search"})):((0,n.uX)(),(0,n.Wv)(b,{key:1,name:"clear",class:"cursor-pointer",onClick:t[0]||(t[0]=e=>p.searchText="")}))])),_:1},8,["modelValue"])]),(0,n.Lk)("div",h,[(0,n.bF)(B,{modelValue:T.selectedUser,"onUpdate:modelValue":[t[3]||(t[3]=e=>T.selectedUser=e),e.selectUser],options:p.userOptions,label:"Lọc theo người dùng",outlined:"","emit-value":"","map-options":"",dense:""},null,8,["modelValue","options","onUpdate:modelValue"])]),(0,n.Lk)("div",u,[(0,n.eW)(" Menu "),(0,n.bF)(b,{name:"expand_more",dense:""}),e.userDetails.isPro?((0,n.uX)(),(0,n.Wv)(C,{key:0,"touch-position":""},{default:(0,n.k6)((()=>[(0,n.bF)(X,{style:{"min-width":"150px"}},{default:(0,n.k6)((()=>[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadTaiTucBHYTBT},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHYT bổ trợ")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBhytThang},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Hoa hồng BHYT")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBHXHThang},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Hoa hồng BHXH TN")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[4]||(t[4]=e=>p.loadBhytByUserName(1))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đã thu tiền BHYT")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[5]||(t[5]=e=>p.loadBhytByUserName(0))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đã thu tiền BHXH")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.taiTucBHYT1thang},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHYT ("+(0,l.v_)(e.userDetails.id)+")",1)])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[6]||(t[6]=e=>p.loadBhyts({thang:1}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHYT(xã)")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.taiTucBHYT2thang},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục 2 tháng ("+(0,l.v_)(e.userDetails.id)+")",1)])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[7]||(t[7]=e=>p.loadBhyts({thang:2}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục 2 tháng (xã)")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[8]||(t[8]=t=>p.loadBHXHTNs({tienNop:1,taiTucBHXH:1,userName:e.userDetails.id}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHXH")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[9]||(t[9]=t=>p.loadBHXHTNs({tienNop:1,userName:e.userDetails.id}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đóng BHXH cho "+(0,l.v_)(e.userDetails.id),1)])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[10]||(t[10]=t=>p.loadBHXHTNs({tienNop:1,maXa:e.userDetails.maXa}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đóng BHXH (xã)")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBhytsHetHan},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đã hết hạn")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBhytsDisable},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đã liên hệ")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBhytsCompleted},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đánh dấu sao")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBaoCaoChiTietGiaoDich},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Báo cáo Chi Tiết Giao Dịch")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.inC17},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("In C17")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.printDanhSachTraThe},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("In Danh sách trả thẻ")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.copyMaSoBhxhToClipboard},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Copy tất cả mã số BHXH")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:e.copyHoTenToClipboard},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Copy tất cả họ tên")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.copySoDienThoaiToClipboard},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Copy tất cả số điện thoại")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.copyNamePhoneClipboard},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Lưu danh bạ")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:e.batTatRemove},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tắt/Bật danh sách")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[11]||(t[11]=e=>p.timMoi(p.searchText))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tìm mới")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadBhytByNamSinh},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tìm theo năm sinh")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadTaiTucBHYT},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHYT (ssm)")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:p.loadTaiTucBHXH},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục BHXH (ssm)")])),_:1})])),_:1},8,["onClick"])),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[12]||(t[12]=t=>e.capNhatBHXHTN(p.searchText))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đồng bộ BHXH TN")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[13]||(t[13]=t=>e.resetBhyt(p.searchText?e.bhyts.filter((e=>e.userName!==p.searchText)):[]))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Xóa danh sách")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[14]||(t[14]=t=>e.resetBhyt(p.searchText?e.bhyts.filter((e=>e.userName===p.searchText)):[]))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Giữ lại danh sách")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[15]||(t[15]=t=>e.resetBhyt(p.searchText?e.bhyts.filter((e=>!(e.soDienThoai||e.soDienThoai2))):[]))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Thiếu số điện thoại")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[16]||(t[16]=t=>p.loadBHXHTNs({isCMND:1,maXa:e.userDetails.maXa}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Thiếu CCCD")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[17]||(t[17]=e=>p.loadBhytByUserNameTaiTuc())},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Tái tục")])),_:1})])),_:1})),[[N]]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[18]||(t[18]=t=>e.getBhyts({isPhone:!0,maXa:e.userDetails.maXa,name:p.searchText}))},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Có số điện thoại")])),_:1})])),_:1})),[[N]]),(0,n.bF)(f),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(H,{clickable:"",onClick:t[19]||(t[19]=e=>p.loadBhytByUserName())},{default:(0,n.k6)((()=>[(0,n.bF)(y,null,{default:(0,n.k6)((()=>[(0,n.eW)("Đã thu tiền")])),_:1})])),_:1})),[[N]])])),_:1})])),_:1})):(0,n.Q3)("",!0)])])])),_:1}),e.filteredBhyts.length?((0,n.uX)(),(0,n.Wv)(D,{key:0},{default:(0,n.k6)((()=>[e.tongSoBHXH===e.filteredBhyts.length?((0,n.uX)(),(0,n.Wv)(v,{key:0,modelValue:T.expanded,"onUpdate:modelValue":t[20]||(t[20]=e=>T.expanded=e),label:`Tổng tiền BHXH TN: ${parseInt(e.tongTienBHXH).toLocaleString()}/ ${e.tongSoBHXH} sổ`,caption:"Xem chi tiết"},{default:(0,n.k6)((()=>[(0,n.eW)(" Hoa hồng: "+(0,l.v_)(parseInt((.049*e.tongTienBHXH).toFixed(0)).toLocaleString())+" ",1),c,(0,n.eW)(" Hoa hồng BHXH (năm): "+(0,l.v_)(parseInt((.049*(.22*e.tongMucDongBHXH-66e3*e.tongSoBHXH)*12).toFixed(0)).toLocaleString())+"đ ("+(0,l.v_)(parseInt(e.tongMucDongBHXH).toLocaleString())+") ",1)])),_:1},8,["modelValue","label"])):((0,n.uX)(),(0,n.Wv)(v,{key:1,modelValue:T.expanded,"onUpdate:modelValue":t[21]||(t[21]=e=>T.expanded=e),label:`Tổng tiền: ${parseInt(p.tongTienBHYT).toLocaleString()}/ ${e.filteredBhyts.length} thẻ`,caption:"Xem chi tiết"},{default:(0,n.k6)((()=>[(0,n.Lk)("strong",null,"Hoa hồng BHYT: "+(0,l.v_)(parseInt((.0264*p.tongTienBHYT).toFixed(0)).toLocaleString())+" ("+(0,l.v_)(parseInt((p.tongTienBHYT/(e.filteredBhyts.length||1)*.0264).toFixed(0)).toLocaleString())+"/thẻ)",1),r,d,(0,n.eW)(" Hoa hồng BHXH (năm): "+(0,l.v_)(parseInt((.049*(.22*e.tongMucDongBHXH-66e3*e.tongSoBHXH)*12).toFixed(0)).toLocaleString())+"đ ("+(0,l.v_)(parseInt(e.tongMucDongBHXH).toLocaleString())+") ",1),g,(0,n.Lk)("span",null,"Có "+(0,l.v_)(e.tongSoBHXH)+" BHXHTN (tái tục): "+(0,l.v_)(parseInt((.049*e.tongTienBHXH).toFixed(0)).toLocaleString())+" ("+(0,l.v_)(parseInt(e.tongTienBHXH).toLocaleString())+") ",1)])),_:1},8,["modelValue","label"])),(0,n.bF)(X,null,{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.filteredBhyts,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id},[(0,n.bF)(_,{bhyt:e},null,8,["bhyt"]),(0,n.bF)(f,{spaced:"",inset:""})])))),128))])),_:1})])),_:1})):((0,n.uX)(),(0,n.Wv)(D,{key:1},{default:(0,n.k6)((()=>[(0,n.eW)(" Nhập họ và tên hoặc mã số BHXH, mã thẻ BHYT vào ô Tìm kiếm và nhấn ENTER để tra cứu. ")])),_:1}))])),_:1}),(0,n.bF)(S,{modelValue:T.dialogShow,"onUpdate:modelValue":t[22]||(t[22]=e=>T.dialogShow=e),persistent:""},{default:(0,n.k6)((()=>[(0,n.bF)(W)])),_:1},8,["modelValue"])])),_:1})}a(3009),a(3647),a(7458),a(1807),a(5512),a(5263),a(9875),a(4559);var T=a(6980),p=a(3177),b=a(1627);const k=(0,n.Lk)("div",{class:"text-h6"},"Cập nhật thông tin BHYT",-1);function B(e,t,a,i,l,s){const o=(0,n.g2)("q-space"),h=(0,n.g2)("q-btn"),u=(0,n.g2)("q-card-section"),c=(0,n.g2)("q-input"),r=(0,n.g2)("q-form"),d=(0,n.g2)("q-card"),g=(0,n.gN)("close-popup");return(0,n.uX)(),(0,n.Wv)(d,null,{default:(0,n.k6)((()=>[(0,n.bF)(u,{class:"row items-center q-pb-lg"},{default:(0,n.k6)((()=>[k,(0,n.bF)(o),(0,n.bo)((0,n.bF)(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[g]])])),_:1}),(0,n.bF)(u,null,{default:(0,n.k6)((()=>[(0,n.bF)(r,{onSubmit:s.submit,class:"q-gutter-md"},{default:(0,n.k6)((()=>[(0,n.bF)(c,{modelValue:s.form.maPhuongThucDong,"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.maPhuongThucDong=e),label:"Phương thức đóng (1,3,6,12 tháng)"},null,8,["modelValue"]),(0,n.bF)(c,{modelValue:s.form.mucDong,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.mucDong=e),label:"Mức thu nhập lựa chọn"},null,8,["modelValue"]),(0,n.bF)(c,{modelValue:s.form.denThangDt,"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.denThangDt=e),type:"date",label:"Đến tháng"},null,8,["modelValue"]),(0,n.bF)(h,{type:"submit",label:"Lưu",color:"primary"})])),_:1},8,["onSubmit"])])),_:1})])),_:1})}const y={name:"BhytUpdateDialog",computed:{...(0,T.L8)("bhyts",["getCurrentBhyt"]),form(){return{maSoBhxh:this.getCurrentBhyt.maSoBhxh,mucDong:this.getCurrentBhyt.mucDong,maPhuongThucDong:this.getCurrentBhyt.maPhuongThucDong,denThangDt:this.getCurrentBhyt.denThangDt}}},methods:{...(0,T.i0)("bhyts",["setCurrentBhyt","updateDenNgayBHXH"]),async submit(){await this.updateDenNgayBHXH(this.form),this.setCurrentBhyt(null)}}};var H=a(2807),f=a(3316),X=a(4189),C=a(3676),D=a(1693),v=a(9200),_=a(9270),x=a(8672),W=a(8582),S=a.n(W);const F=(0,H.A)(y,[["render",B]]),N=F;S()(y,"components",{QCard:f.A,QCardSection:X.A,QSpace:C.A,QBtn:D.A,QForm:v.A,QInput:_.A}),S()(y,"directives",{ClosePopup:x.A});var L=a(660);function w(e){if(!e)return!1;if(e=e.trim(),e.split(" ").length<2)return!1;const t=e.split(" ");for(let a=0;a<t.length;a++)if(!/^[A-Za-z]+$/.test(t[a]))return!1;return!0}function $(e){if(!e)return"";const t=e.match(/\d+/g),a=t?.join("");return a&&a.length>=10?a.slice(-10):""}function I(e){return!!e&&(12===e.length&&!!/^\d+$/.test(e))}function A(e){return e?e.split("|")[0]:""}function q(e){if(!e)return!1;if(10!==e.length)return!1;if(!/^\d+$/.test(e))return!1;const t=e.substring(0,2),a=["09","03","07","08"];return!!a.includes(t)}function Y(e){const t=A(e);return I(t)?"Số CCCD":q(t)?"Số điện thoại di động":w(t)?"Họ và tên":10===$(t).length?"Dãy 10 chữ số cuối":"Loại chuỗi không xác định"}const V={components:{ThongTinTheBHYT:p.A,BhytUpdateDialog:N},data(){return{tuNgayDenNgay:"",soBienLai:"",selectedUser:null,dialogShow:!1,expanded:!1}},computed:{...(0,T.L8)("bhyts",["bhyts","filteredBhyts","tongTienBHXH","tongMucDongBHXH","tongSoBHXH","getCurrentBhyt"]),...(0,T.aH)("auth",["userDetails"]),userOptions(){return[{label:"Tất cả",value:null},{label:this.userDetails?.id,value:this.userDetails?.id},{label:this.userDetails?.maNhanVienThu?.slice(0,4),value:this.userDetails?.maNhanVienThu},{label:this.userDetails?.name?.slice(0,6),value:this.userDetails?.name}]},tongTienBHYT(){return 0===this.filteredBhyts.length?0:this.filteredBhyts.map((e=>e.tongTien||0)).reduce(((e,t)=>e+parseInt(t)),0)},searchText:{get(){return this.$store.state.bhyts.searchText},set(e){this.$store.commit("bhyts/SET_SEARCH_TEXT",e)}}},methods:{...(0,T.i0)("bhyts",["getBhyts","resetBhyt","traCuuBhyts","updateBhyt","hoSoDaXuLy","dongBoDuLieu","traCuuTheoTen","getDanhSachKhachHangTaiTuc","copyHoTenToClipboard","batTatRemove","capNhatBHXHTN","searchBhyts","selectUser","traCuuBHXH","traCuuMaSoBHXH"]),...(0,T.i0)("auth",["firebaseUpdateUser","handleAuthStateChanged"]),...(0,T.PY)({setSearchText:"bhyts/SET_SEARCH_TEXT"}),sleep(e){return new Promise((t=>setTimeout(t,e)))},taiTucBHYT1thang(){this.searchText="",this.getBhyts({thang:1,completed:"0",disabled:"0",taiTuc:"1",userName:this.userDetails.id})},taiTucBHYT2thang(){this.searchText="",this.getBhyts({thang:2,completed:"0",disabled:"0",taiTuc:"1",userName:this.userDetails.id})},async loadTaiTucBHXH(){this.searchText="";const e=await this.getDanhSachKhachHangTaiTuc({filterItems:[],maxResultCount:500,skipCount:0,mangLuoiId:this.userDetails.quaTrinhCongTac.mangLuoiId,tuThang:"2020-01-01 00:00:00",denThang:"2025-01-01 00:00:00",type:-1,loaiDichVu:0});this.capNhatBHXHTN([...new Set(e.map((e=>e.maSoBHXH)))].join())},async loadTaiTucBHYT(){this.searchText="";const e=await this.getDanhSachKhachHangTaiTuc({filterItems:[],maxResultCount:5e3,skipCount:0,mangLuoiId:this.userDetails.quaTrinhCongTac.mangLuoiId,tuThang:"2020-01-01 00:00:00",denThang:"2025-01-01 00:00:00",type:-1,loaiDichVu:1});this.dongBoDuLieu([...new Set(e.map((e=>e.maSoBHXH)))].join())},async loadBaoCaoChiTietGiaoDich(){const e=new Date,t=e.getFullYear(),a=e.getMonth();2!==this.searchText.split(" : ").length&&(this.tuNgayDenNgay=this.searchText=`${new Date(t,a-2,1).toISOString().slice(0,10)} : ${new Date(2024,12,31).toISOString().slice(0,10)}`),this.$q.dialog({title:"Báo cáo chi tiết giao dịch",message:"Từ ngày : đến ngày?",prompt:{model:this.searchText,type:"text"},cancel:!0,persistent:!0}).onOk((async e=>{const t=e.split(" : ");try{await this.hoSoDaXuLy({tuNgay:t[0],denNgay:t[1],mangLuoiId:this.userDetails.quaTrinhCongTac.mangLuoiId})}catch(a){b.A.create({message:"Không thể kế nối đến máy chủ !",color:"red"})}}))},async inC17(){if(!this.bhyts.length&&!this.tuNgayDenNgay)return b.A.create({type:"negative",message:"Vào báo cáo giao dịch trước khi xuất C17."}),void this.loadBaoCaoChiTietGiaoDich();this.$q.dialog({title:"In C17 (quyển)",message:"Số biên lai?",prompt:{model:this.soBienLai,type:"text"},cancel:!0,persistent:!0}).onOk((async e=>{if(!e)return;const t=new Map;for(let s=1;s<10;s++)await t.set(`${e}0${s}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${e}0${s}`,ngayLap:null});for(let s=10;s<100;s++)await t.set(`${e}${s}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${e}${s}`,ngayLap:null});await t.set(`${parseInt(e+99)+1}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${parseInt(e+99)+1}`,ngayLap:null});const a=await this.bhyts.filter((t=>t.soBienLai.startsWith(e)));if(!a.length)return b.A.create({type:"negative",message:"Không tìm thấy quyển biên lai!"}),null;for(let s=0;s<this.bhyts.length;s++){const e=this.bhyts[s];if(t.has(e.soBienLai)){const a=t.get(e.soBienLai);t.set(e.soBienLai,{...a,ngayLap:e.ngayLap,tienBHYT:1===e.maThuTuc?parseInt(e.tongTien)+a.tienBHYT:a.tienBHYT,tienBHXH:0===e.maThuTuc?parseInt(e.tongTien)+a.tienBHXH:a.tienBHXH,tongTien:parseInt(e.tongTien)+a.tongTien})}}await this.sleep(1e3);const n=await fetch(`https://app.hotham.vn/api/mau-c17-all/1/pdf?tienBHYT=${a.filter((e=>1==e.maThuTuc)).map((e=>e.tongTien)).reduce(((e,t)=>e+t),0)}&tienBHXH=${a.filter((e=>0==e.maThuTuc)).map((e=>e.tongTien)).reduce(((e,t)=>e+t),0)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([...t.values()])}),i=await n.blob();if(i.errors)throw console.error(i.errors),new Error("Failed to fetch API");var l=document.createElement("a");l.href=window.URL.createObjectURL(i),l.download=`${(new Date).toISOString().slice(0,10)}-tham-tu-lap-c17.pdf`,l.click()}))},async print(e){let t=document.createElement("a");t.target="_blank";let a=`https://app.hotham.vn/mau-c17/${(new Date).toISOString().slice(0,10)}/pdf?maSoBhxhs=${e}`;t.href=a,t.click()},loadBhytByNamSinh(){this.searchText="",this.$q.dialog({title:"Tìm thẻ BHYT theo năm sinh",message:"Nhập năm sinh?",prompt:{model:this.searchText,isValid:e=>4==e.length,type:"number"},cancel:!0,persistent:!0}).onOk((e=>{this.getBhyts({completed:"0",disabled:"0",maXa:this.userDetails.maXa,nam:e})}))},loadBhytByUserNameTaiTuc(){this.getBhyts({userName:this.searchText,completed:"0",disabled:"0"})},loadBhytByUserName(e){this.searchText,1===e?this.getBhyts({userName:this.userDetails.maNhanVienThu,isBHYT:1}):0===e?this.getBhyts({userName:this.userDetails.maNhanVienThu,isBHXHTN:1}):this.getBhyts({userName:this.searchText||this.userDetails.id})},loadBhytByName(){this.$q.dialog({title:"Tìm thẻ BHYT",message:"Nhập nội dung tìm kiếm?",prompt:{model:this.searchText,isValid:e=>e.length>=2,type:"text"},cancel:!0,persistent:!0}).onOk((e=>{this.getBhyts({name:e,maXa:e.length<9?this.userDetails.maXa:null})}))},loadBhytThang(){this.searchText="",this.$q.dialog({title:"Tháng biên lai",message:"Nhập tháng?",prompt:{model:(new Date).getMonth()+1,type:"text"},cancel:!0,persistent:!0}).onOk((e=>{this.getBhyts({thangBienLai:e,userName:this.userDetails.id})}))},loadBHXHThang(){this.searchText="",this.$q.dialog({title:"Tháng biên lai",message:"Nhập tháng?",prompt:{model:(new Date).getMonth()+1,type:"text"},cancel:!0,persistent:!0}).onOk((e=>{this.getBhyts({thangBienLaiTN:e,userName:this.userDetails.id})}))},loadBhyts({thang:e=1}){this.searchText="",this.searchText="",this.getBhyts({thang:e,completed:"0",disabled:"0",taiTuc:"1",maXa:this.userDetails.maXa,name:this.searchText})},loadTaiTucBHYTBT(){this.searchText="",this.getBhyts({userName:this.userDetails.id,taiTucBHYTBT:"1"})},loadBHXHTNs(e){this.searchText="",this.getBhyts({...e,name:this.searchText})},loadBhytsHetHan(){this.searchText="",this.getBhyts({maXa:this.userDetails.maXa,completed:"0",disabled:"0",hetHan:"1",name:this.searchText})},loadBhytsDisable(){this.searchText="",this.getBhyts({maXa:this.userDetails.maXa,disabled:1})},loadBhytsCompleted(){this.searchText="",this.getBhyts({maXa:this.userDetails.maXa,completed:1,disabled:"0"})},async timKiem(e){const t=e.split("|");t.length>1&&(e=t[0],this.setSearchText(t[0]));const a=e.split(","),n=/[0-9]/g;for(let s=0;s<a.length;s++){const e=a[s].split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),t=e.match(n),i=Y(t?.join(""));if("Dãy 10 chữ số cuối"===i)try{const e=t.join("").slice(-10);this.traCuuBHXH(e),this.searchText=e}catch(l){console.log(l)}else try{await this.traCuuMaSoBHXH({hoTen:e,maXa:this.userDetails.maXa,userName:this.userDetails.id,maHuyen:this.userDetails.maHuyen,maTinh:this.userDetails.maTinh})}catch(l){b.A.create({type:"negative",message:"Không thực hiện được!"+l})}}a.length>1&&(this.searchText=""),this.$refs.inputSearch.select();const i={...this.$route.query,q:e};this.$router.replace({query:i})},async timMoi(e){const t=e.split(","),a=JSON.parse(localStorage.getItem("hoTens"))||[],n=t.filter((e=>!a.includes(e)));this.searchText=n.join(),this.timKiem(this.searchText)},async khoiTao(){this.resetBhyt([]),this.$route.query.key&&(this.key=await this.saveBHYT(this.$route.query.key))},async printDanhSachTraThe(){let e=document.createElement("a");e.target="_blank",e.href=`https://app.hotham.vn/danh-sach-tra-the/1/pdf?maSoBhxhs=${this.bhyts.map((e=>e.maSoBhxh)).join(",")}`,e.click()},copyMaSoBhxhToClipboard(){navigator.clipboard.writeText(this.bhyts.map((e=>e.maSoBhxh))).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},copySoDienThoaiToClipboard(){navigator.clipboard.writeText([...new Set(this.bhyts.map((e=>e.soDienThoai2||e.soDienThoai)))].join("\r\n")).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},copyNamePhoneClipboard(){const e=new Map;for(let t of this.bhyts)e.set(t.soDienThoai2||t.soDienThoai,t);this.download("NamePhone.csv","Name\tPhone\r\n"+[...new Set([...e.values()].map((({soDienThoai2:e,soDienThoai:t,hoTen:a,ngaySinhDt:n,denNgayDt:i,userName:l,soTheBhyt:s})=>`${a} T${new Date(i).getMonth()+1}${s?.slice(0,2)||""}${l==this.userDetails.id||l==this.userDetails.maNhanVienThu?"":"_"}${new Date(n).getFullYear()}\t${e||t}`))).values()].join("\r\n"))},download(e,t){var a=document.createElement("a");if(a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),a.dispatchEvent(n)}else a.click()},async printPhuLucThanhVienHGD(){if(this.bhyts.length>15||0===this.bhyts.length)return void b.A.create({type:"negative",message:"Không thực hiện được!"});let e=document.createElement("a");e.target="_blank",e.href=`https://app.hotham.vn/thanh-vien-ho-gia-dinh/1/pdf?maXaUpdate=${this.userDetails.maXa}&maSoBhxhs=${this.bhyts.map((e=>e.maSoBhxh)).join(",")}`,e.click()}},watch:{getCurrentBhyt:function(e){this.dialogShow=!!e},userDetails:async function({maXa:e}){e&&L.api.post("/api/update-bhyt-data",{api_key:this.userDetails.isLogin,mang_luoi_id:this.userDetails.quaTrinhCongTac.mangLuoiId,force:!1}).then((e=>{console.log("Cập nhật dữ liệu Bhyt thành công!")})).catch((e=>{console.error("Lỗi cập nhật dữ liệu Bhyt:",e)}))}}};var U=a(7716),E=a(492),M=a(9313),Q=a(9519),P=a(3999),O=a(7743),j=a(5173),K=a(386),R=a(9459),G=a(3796),J=a(2156);const z=(0,H.A)(V,[["render",m]]),Z=z;S()(V,"components",{QPage:U.A,QCard:f.A,QCardSection:X.A,QInput:_.A,QIcon:E.A,QSelect:M.A,QMenu:Q.A,QList:P.A,QItem:O.A,QItemSection:j.A,QSeparator:K.A,QExpansionItem:R.A,QItemLabel:G.A,QDialog:J.A}),S()(V,"directives",{ClosePopup:x.A})}}]);