"use strict";(globalThis["webpackChunktodo_buudienxatulap"]=globalThis["webpackChunktodo_buudienxatulap"]||[]).push([[846],{3846:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var i=a(9835),n=a(6970),s=a(1957);const l={class:"inline bg-orange-4 rounded-borders cursor-pointer"},o={class:"fit flex flex-center text-center non-selectable q-pa-md"},h=(0,i._)("br",null,null,-1),c={class:"q-gutter-y-md column"};function r(e,t,a,r,u,d){const p=(0,i.up)("q-item-section"),m=(0,i.up)("q-item"),g=(0,i.up)("q-list"),w=(0,i.up)("q-menu"),y=(0,i.up)("q-banner"),T=(0,i.up)("q-icon"),k=(0,i.up)("q-input"),B=(0,i.up)("ThongTinTheBHYT"),f=(0,i.up)("q-separator"),b=(0,i.up)("q-page"),C=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(b,{class:""},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{"inline-actions":"",class:(0,n.C_)(["bg-orange-4","list-header text-white text-center"])},{default:(0,i.w5)((()=>[(0,i._)("div",l,[(0,i._)("div",o,[(0,i.Uk)(" Tra cứu "+(0,n.zw)(e.bhyts.length)+"/"+(0,n.zw)(parseInt(e.tongTien).toLocaleString())+"đ!",1),h,(0,i.Uk)("(Bấm vào đây và lựa chọn) ")]),(0,i.Wm)(w,{"touch-position":""},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{style:{"min-width":"100px"}},{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytByUserName},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Đã thu tiền")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytByNamSinh},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tìm theo năm sinh")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytByName},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tìm tất cả")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:t[0]||(t[0]=e=>d.loadBhyts({thang:1}))},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tái tục 1 tháng")])),_:1})])),_:1})),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:t[1]||(t[1]=e=>d.loadBhyts({thang:2}))},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tái tục 2 tháng")])),_:1})])),_:1})),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:t[2]||(t[2]=t=>d.loadBHXHTNs({isBHXHTN:1,taiTucBHXH:1,completed:"0",disabled:"0",maXa:e.userDetails.maXa}))},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tái tục BHXH TN 1 tháng")])),_:1})])),_:1})),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:t[3]||(t[3]=t=>d.loadBHXHTNs({isBHXHTN:1,maXa:e.userDetails.maXa}))},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tái tục BHXH TN (All)")])),_:1})])),_:1})),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytsHetHan},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Đã hết hạn")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytsDisable},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Đã liên hệ")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBhytsCompleted},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Đánh dấu sao")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadBaoCaoChiTietGiaoDich},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Báo cáo Chi Tiết Giao Dịch")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.inC17},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("In C17")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.printDanhSachTraThe},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("In Danh sách trả thẻ")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.loadTaiTucBHXH},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tái tục BHXH")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.copyMaSoBhxhToClipboard},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Copy tất cả mã số BHXH")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:e.copyHoTenToClipboard},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Copy tất cả họ tên")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.copySoDienThoaiToClipboard},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Copy tất cả số điện thoại")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:d.copyNamePhoneClipboard},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Copy danh bạ")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:e.batTatRemove},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Tắt/Bật danh sách")])),_:1})])),_:1},8,["onClick"])),[[C]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{clickable:"",onClick:t[4]||(t[4]=t=>e.resetBhyt([]))},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Xóa danh sách")])),_:1})])),_:1})),[[C]])])),_:1})])),_:1})])])),_:1}),(0,i._)("div",c,[(0,i.Wm)(k,{outlined:"",modelValue:u.searchText,"onUpdate:modelValue":t[6]||(t[6]=e=>u.searchText=e),ref:"inputSearch",onKeyup:t[7]||(t[7]=(0,s.D2)((e=>d.timKiem(u.searchText)),["enter"])),dense:""},{append:(0,i.w5)((()=>[""!==u.searchText?((0,i.wg)(),(0,i.j4)(T,{key:0,name:"close",onClick:t[5]||(t[5]=e=>u.searchText=""),class:"cursor-pointer"})):(0,i.kq)("",!0),(0,i.Wm)(T,{name:"search"})])),_:1},8,["modelValue"])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.bhyts,(e=>((0,i.wg)(),(0,i.j4)(g,{key:e.id},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{bhyt:e},null,8,["bhyt"]),(0,i.Wm)(f,{spaced:"",inset:""})])),_:2},1024)))),128))])),_:1})}a(2309);var u=a(3100),d=a(9981),p=a.n(d),m=a(3572),g=a(6950),w=a(8359),y=a(6827);const T={components:{ThongTinTheBHYT:m.Z},data(){return{searchText:""}},computed:{...(0,u.Se)("bhyts",["bhyts","tongTien"]),...(0,u.rn)("auth",["userDetails"])},methods:{...(0,u.nv)("bhyts",["getBhyts","resetBhyt","traCuuBhyts","updateBhyt","hoSoDaXuLy","dongBoDuLieu","traCuuTheoTen","getDanhSachKhachHangTaiTuc","copyHoTenToClipboard","batTatRemove"]),...(0,u.nv)("auth",["firebaseUpdateUser","handleAuthStateChanged"]),sleep(e){return new Promise((t=>setTimeout(t,e)))},async loadTaiTucBHXH(){this.getDanhSachKhachHangTaiTuc({filterItems:[],maxResultCount:500,skipCount:0,mangLuoiId:this.userDetails.mangLuoiId,tuThang:"2023-03-01 00:00:00",denThang:"2023-04-01 00:00:00",type:-1,loaiDichVu:0})},async loadBaoCaoChiTietGiaoDich(){const e=new Date,t=e.getFullYear(),a=e.getMonth();2!==this.searchText.split(" - ").length&&(this.searchText=`${new Date(t,a-2,1).toISOString().slice(0,10)} - ${new Date(2024,12,31).toISOString().slice(0,10)}`);const i=this.searchText.split(" - ");g.Z.show({spinner:w.Z,spinnerSize:"100px"});try{await this.hoSoDaXuLy({tuNgay:i[0],denNgay:i[1],mangLuoiId:this.userDetails.mangLuoiId})}catch(n){y.Z.create({message:"Không thể kế nối đến máy chủ !",color:"red"})}g.Z.hide()},async inC17(){const e=new Map;for(let s=1;s<10;s++)await e.set(`${this.searchText}0${s}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${this.searchText}0${s}`,ngayLap:null});for(let s=10;s<100;s++)await e.set(`${this.searchText}${s}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${this.searchText}${s}`,ngayLap:null});await e.set(`${parseInt(this.searchText+99)+1}`,{tongTien:0,tienBHYT:0,tienBHXH:0,soBienLai:`${parseInt(this.searchText+99)+1}`,ngayLap:null});const t=await this.bhyts.filter((e=>e.soBienLai.startsWith(this.searchText??"21871")));for(let s=0;s<this.bhyts.length;s++){const t=this.bhyts[s];if(t.userId===this.userDetails.id&&e.has(t.soBienLai)){const a=e.get(t.soBienLai);e.set(t.soBienLai,{...a,ngayLap:t.ngayLap,tienBHYT:1===t.maThuTuc?parseInt(t.tongTien)+a.tienBHYT:a.tienBHYT,tienBHXH:0===t.maThuTuc?parseInt(t.tongTien)+a.tienBHXH:a.tienBHXH,tongTien:parseInt(t.tongTien)+a.tongTien})}}await this.sleep(1e3);const a=await fetch(`https://app.hotham.vn/api/mau-c17-all/1/pdf?tienBHYT=${t.filter((e=>1==e.maThuTuc)).map((e=>e.tongTien)).reduce(((e,t)=>e+t),0)}&tienBHXH=${t.filter((e=>0==e.maThuTuc)).map((e=>e.tongTien)).reduce(((e,t)=>e+t),0)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([...e.values()])}),i=await a.blob();if(i.errors)throw console.error(i.errors),new Error("Failed to fetch API");var n=document.createElement("a");n.href=window.URL.createObjectURL(i),n.download=`${(new Date).toISOString().slice(0,10)}-tham-tu-lap-c17.pdf`,n.click()},async print(e){let t=document.createElement("a");t.target="_blank";let a=`https://app.hotham.vn/mau-c17/${(new Date).toISOString().slice(0,10)}/pdf?maSoBhxhs=${e}`;t.href=a,t.click()},loadBhytByNamSinh(){this.getBhyts({completed:"0",disabled:"0",maXa:this.userDetails.maXa,nam:this.searchText})},loadBhytByUserName(){this.searchText||y.Z.create({type:"negative",message:"Nhập 1 hoặc 0!"+err}),this.getBhyts({userName:this.searchText})},loadBhytByName(){this.getBhyts({name:this.searchText})},loadBhyts({thang:e=1}){this.getBhyts({thang:e,completed:"0",disabled:"0",taiTuc:"1",maXa:this.userDetails.maXa,name:this.searchText})},loadBHXHTNs(e){this.getBhyts({...e,name:this.searchText})},loadBhytsHetHan(){this.getBhyts({maXa:this.userDetails.maXa,completed:"0",disabled:"0",hetHan:"1",name:this.searchText})},loadBhytsDisable(){this.getBhyts({maXa:this.userDetails.maXa,disabled:1})},loadBhytsCompleted(){this.getBhyts({maXa:this.userDetails.maXa,completed:1,disabled:"0"})},async timKiem(e){const t=e.split("|");t.length>1&&(this.searchText=e=t[0]);const a=e.split(",");a.length>1&&await this.traCuuBhyts({searchText:e,maXa:this.userDetails.maXa});const i=/[0-9]/g;for(let s=0;s<a.length;s++){const e=a[s].split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),t=e.match(i);if(t)await this.dongBoDuLieu(t.join("")),await this.sleep(500);else try{await this.traCuuTheoTen({name:e,maXa:this.userDetails.maXa})}catch(n){y.Z.create({type:"negative",message:"Không thực hiện được!"+n})}}this.$refs.inputSearch.select()},async khoiTao(){this.resetBhyt([]),this.$route.query.key&&(this.key=await this.saveBHYT(this.$route.query.key))},async printDanhSachTraThe(){let e=document.createElement("a");e.target="_blank",e.href=`https://app.hotham.vn/danh-sach-tra-the/1/pdf?maSoBhxhs=${this.bhyts.map((e=>e.maSoBhxh)).join(",")}`,e.click()},copyMaSoBhxhToClipboard(){navigator.clipboard.writeText(this.bhyts.map((e=>e.maSoBhxh))).then((function(){y.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){y.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},copySoDienThoaiToClipboard(){navigator.clipboard.writeText([...new Set(this.bhyts.map((e=>e.soDienThoai)))].join("\r\n")).then((function(){y.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){y.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},copyNamePhoneClipboard(){navigator.clipboard.writeText("Name\tPhone\r\n"+[...new Map(this.bhyts.map((({soDienThoai:e,hoTen:t,ngaySinhDt:a})=>[e,t+" "+new Date(a).getFullYear()+"\t"+e]))).values()].join("\r\n")).then((function(){y.Z.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){y.Z.create({type:"negative",message:"Không thực hiện được!"+e})}))},async taoKhoaMoi(){await this.sleep(1e3);let e={method:"post",maxBodyLength:1/0,url:"https://ssm-api.vnpost.vn/api/TokenAuth/Authenticate",headers:{Accept:"application/json","Content-Type":"application/json"},data:this.userDetails.smsText};const{data:t}=await p().request(e);await this.firebaseUpdateUser({userId:this.userDetails.userId,updates:{...this.userDetails,isLogin:t.result.accessToken}}),await this.handleAuthStateChanged();const a=new Date((new Date).getTime()+72e4);localStorage.setItem("expiration",a.toISOString())}},async created(){const e=localStorage.getItem("expiration");(!e||new Date(e)<new Date)&&(console.log("tao khoa mới!"),this.taoKhoaMoi())}};var k=a(1639),B=a(9885),f=a(7128),b=a(7858),C=a(3246),H=a(490),_=a(1233),x=a(7471),D=a(2857),S=a(2218),X=a(2146),v=a(9984),j=a.n(v);const U=(0,k.Z)(T,[["render",r]]),I=U;j()(T,"components",{QPage:B.Z,QBanner:f.Z,QMenu:b.Z,QList:C.Z,QItem:H.Z,QItemSection:_.Z,QInput:x.Z,QIcon:D.Z,QSeparator:S.Z}),j()(T,"directives",{ClosePopup:X.Z})}}]);