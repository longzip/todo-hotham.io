"use strict";(globalThis["webpackChunktodolist"]=globalThis["webpackChunktodolist"]||[]).push([[300],{1488:(e,n,a)=>{a.r(n),a.d(n,{default:()=>Q});var o=a(1758),t=a(8790),s=a(9104);const l={class:"q-pa-md"},i={class:"q-gutter-y-md column"},h=["href"],d={class:"text-strike"},u={class:"text-bold"},r={class:"text-strike"},c={class:"text-h6"},g=["href"],p={class:"text-h6"},m={class:"row items-center justify-end"};function T(e,n,a,T,k,C){const b=(0,o.g2)("q-btn"),y=(0,o.g2)("ListHeader"),D=(0,o.g2)("q-icon"),v=(0,o.g2)("q-input"),f=(0,o.g2)("q-item-label"),F=(0,o.g2)("q-item-section"),_=(0,o.g2)("q-badge"),N=(0,o.g2)("q-item"),S=(0,o.g2)("q-separator"),w=(0,o.g2)("q-list"),L=(0,o.g2)("q-card-section"),H=(0,o.g2)("q-card-actions"),I=(0,o.g2)("q-card"),V=(0,o.g2)("q-dialog"),A=(0,o.g2)("q-date"),O=(0,o.g2)("q-popup-proxy"),P=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.bF)(y,{bgcolor:"bg-orange-4"},{default:(0,o.k6)((()=>[(0,o.eW)("KHL "+(0,t.v_)(e.doanhThu.toLocaleString())+"đ / "+(0,t.v_)(e.tongSoBuuGui)+" bưu gửi ",1),(0,o.bF)(b,{rounded:"",color:"primary",onClick:n[0]||(n[0]=n=>e.copySoDienThoaiToClipboard()),icon:"content_copy"}),(0,o.bF)(b,{rounded:"",color:"primary",onClick:n[1]||(n[1]=n=>e.copyChiCODToClipboard()),icon:"done_all"})])),_:1}),(0,o.Lk)("div",i,[(0,o.bF)(v,{outlined:"",modelValue:e.searchText,"onUpdate:modelValue":n[3]||(n[3]=n=>e.searchText=n),placeholder:"Từ khóa",hint:`Cước còn: ${(e.doanhThu-e.tongCuocDaThanhToan).toLocaleString()}đ / đã trừ: ${e.tongCuocDaThanhToan.toLocaleString()}đ / `,onKeyup:n[4]||(n[4]=(0,s.jR)((n=>e.traCuu()),["enter"])),dense:""},{append:(0,o.k6)((()=>[""!==e.searchText?((0,o.uX)(),(0,o.Wv)(D,{key:0,name:"close",onClick:n[2]||(n[2]=n=>e.searchText=""),class:"cursor-pointer"})):(0,o.Q3)("",!0),(0,o.bF)(D,{name:"search"})])),_:1},8,["modelValue","hint"])]),(0,o.bF)(w,null,{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.khls.sort((function(e,n){return n.soLuong-e.soLuong})),(n=>((0,o.uX)(),(0,o.CE)("div",{key:n.senderPhone},[(0,o.bF)(N,null,{default:(0,o.k6)((()=>[(0,o.bF)(F,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(n.senderName)+" ",1)])),_:2},1024),(0,o.bF)(f,{caption:"",lines:"2"},{default:(0,o.k6)((()=>[(0,o.Lk)("a",{href:`tel:${n.senderPhone}`},(0,t.v_)(n.senderPhone),9,h)])),_:2},1024),(0,o.bF)(f,{caption:"",lines:"2"},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(n.senderAdd),1)])),_:2},1024)])),_:2},1024),(0,o.bF)(F,{side:"",top:""},{default:(0,o.k6)((()=>[(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.bF)(D,{name:"info",onClick:a=>e.showItems(n.senderPhone),class:"cursor-pointer"},null,8,["onClick"]),(0,o.bF)(_,{color:"teal",label:n.soLuong},null,8,["label"])])),_:2},1024),(0,o.bF)(D,{name:"access_time",onClick:a=>e.showKHL(n.senderPhone)},null,8,["onClick"]),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.Lk)("strong",null,"COD: "+(0,t.v_)(parseInt(n.tongCOD-n.soTienDaChiCOD).toLocaleString()),1),(0,o.Lk)("span",d,(0,t.v_)(parseInt(n.tongCOD).toLocaleString()),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.Lk)("strong",u,"Còn nợ: "+(0,t.v_)(parseInt(n.tongCuoc-n.soTienDaTruCongNo).toLocaleString()),1),(0,o.Lk)("span",r,(0,t.v_)(parseInt(n.soTienDaTruCongNo).toLocaleString()),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)("Tổng cước: "+(0,t.v_)(parseInt(n.tongCuoc).toLocaleString()),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,o.bF)(S,{spaced:"",inset:""})])))),128))])),_:1}),(0,o.bF)(V,{modelValue:e.showSelectedItems,"onUpdate:modelValue":n[5]||(n[5]=n=>e.showSelectedItems=n),"full-height":""},{default:(0,o.k6)((()=>[(0,o.bF)(I,{class:"column full-height"},{default:(0,o.k6)((()=>[(0,o.bF)(L,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",c,[(0,o.eW)((0,t.v_)(e.khl.hoTen)+" ",1),(0,o.bF)(_,{label:e.selectItems.length},null,8,["label"])])])),_:1}),(0,o.bF)(L,{class:"col q-pt-none"},{default:(0,o.k6)((()=>[(0,o.bF)(w,{bordered:""},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(this.allCods.filter((n=>n.soDienThoai==e.khl.soDienThoai)),(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id},[(0,o.bF)(N,null,{default:(0,o.k6)((()=>[(0,o.bF)(F,{avatar:""},{default:(0,o.k6)((()=>[(0,o.bF)(D,{color:"primary",name:"paid"})])),_:1}),(0,o.bF)(F,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,{overline:""},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(e.tenNguoiHuong),1)])),_:2},1024),(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(e.soTaiKhoanNganHang)+"-"+(0,t.v_)(e.tenNganHang),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)("Đã chi: "+(0,t.v_)(parseInt(e.soTienCODvePaypost-e.soTienBuTruCongNo).toLocaleString()),1)])),_:2},1024)])),_:2},1024),(0,o.bF)(F,{side:"",top:""},{default:(0,o.k6)((()=>[(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(e.ngayLamViec),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)("COD: "+(0,t.v_)(parseInt(e.soTienCODvePaypost).toLocaleString()),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)("Cước:"+(0,t.v_)(parseInt(e.soTienBuTruCongNo).toLocaleString()),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])))),128)),(0,o.bF)(S,{spaced:"",inset:"item"}),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.selectItems,(n=>((0,o.uX)(),(0,o.CE)("div",{key:n.id},[(0,o.bF)(N,null,{default:(0,o.k6)((()=>[(0,o.bF)(F,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(n.senderName),1)])),_:2},1024),(0,o.bF)(f,{caption:"",lines:"2"},{default:(0,o.k6)((()=>[(0,o.Lk)("a",{href:`tel:${n.senderPhone}`},(0,t.v_)(n.senderPhone),9,g)])),_:2},1024),(0,o.bF)(f,{caption:"",lines:"2"},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(n.contentNote),1)])),_:2},1024)])),_:2},1024),(0,o.bF)(F,{side:"",top:""},{default:(0,o.k6)((()=>[(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(n.ttNumber),1)])),_:2},1024),(0,o.bF)(D,{name:"content_copy",onClick:a=>e.copyTextToClipboard(n.ttNumber)},null,8,["onClick"]),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)("Số tiền: "+(0,t.v_)(parseInt(n.totalFeeSpecial).toLocaleString()),1)])),_:2},1024),(0,o.bF)(f,{caption:""},{default:(0,o.k6)((()=>[(0,o.eW)((0,t.v_)(new Date(n.updatedDate).toLocaleString()),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,o.bF)(S,{spaced:"",inset:""})])))),128))])),_:1})])),_:1}),(0,o.bF)(H,{align:"right",class:"bg-white text-teal"},{default:(0,o.k6)((()=>[(0,o.bo)((0,o.bF)(b,{flat:"",label:"OK"},null,512),[[P]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.bF)(V,{modelValue:e.showDialog,"onUpdate:modelValue":n[18]||(n[18]=n=>e.showDialog=n),"full-height":""},{default:(0,o.k6)((()=>[(0,o.bF)(I,{class:"column full-height"},{default:(0,o.k6)((()=>[(0,o.bF)(L,null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",p,(0,t.v_)(e.khl.hoTen)+" - "+(0,t.v_)(e.khl.soDienThoai),1)])),_:1}),(0,o.bF)(L,{class:"col q-pt-none"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{modelValue:e.khl.hoTen,"onUpdate:modelValue":n[6]||(n[6]=n=>e.khl.hoTen=n),label:"Họ và tên"},null,8,["modelValue"]),(0,o.bF)(v,{modelValue:e.khl.maCRM,"onUpdate:modelValue":n[8]||(n[8]=n=>e.khl.maCRM=n),label:"Mã CRM"},{append:(0,o.k6)((()=>[(0,o.bF)(D,{name:"content_copy",onClick:n[7]||(n[7]=n=>e.copyTextDienThoaiToClipboard(e.khl.maCRM))})])),_:1},8,["modelValue"]),(0,o.bF)(v,{modelValue:e.khl.hopDong,"onUpdate:modelValue":n[9]||(n[9]=n=>e.khl.hopDong=n),label:"Hợp đồng DVBC"},null,8,["modelValue"]),(0,o.bF)(v,{modelValue:e.khl.ngayHopDong,"onUpdate:modelValue":n[11]||(n[11]=n=>e.khl.ngayHopDong=n),label:"Ngày hợp đồng",mask:"date",rules:["date"],dense:e.dense},{append:(0,o.k6)((()=>[(0,o.bF)(D,{name:"event",class:"cursor-pointer"},{default:(0,o.k6)((()=>[(0,o.bF)(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.k6)((()=>[(0,o.bF)(A,{modelValue:e.khl.ngayHopDong,"onUpdate:modelValue":n[10]||(n[10]=n=>e.khl.ngayHopDong=n)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",m,[(0,o.bo)((0,o.bF)(b,{label:"Đóng",color:"primary",flat:"",dense:e.dense},null,8,["dense"]),[[P]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","dense"]),(0,o.bF)(v,{modelValue:e.khl.tenNguoiHuong,"onUpdate:modelValue":n[12]||(n[12]=n=>e.khl.tenNguoiHuong=n),label:"Tên người hưởng",dense:e.dense},null,8,["modelValue","dense"]),(0,o.bF)(v,{modelValue:e.khl.soTaiKhoanNganHang,"onUpdate:modelValue":n[13]||(n[13]=n=>e.khl.soTaiKhoanNganHang=n),label:"Số tài khoản ngân hàng",dense:e.dense},null,8,["modelValue","dense"]),(0,o.bF)(v,{modelValue:e.khl.tenNganHang,"onUpdate:modelValue":n[14]||(n[14]=n=>e.khl.tenNganHang=n),label:"Tên ngân hàng",dense:e.dense},null,8,["modelValue","dense"]),(0,o.bF)(v,{modelValue:e.khl.soTienBuTruCongNo,"onUpdate:modelValue":n[15]||(n[15]=n=>e.khl.soTienBuTruCongNo=n),label:"Số tiền trừ công nợ",dense:e.dense},null,8,["modelValue","dense"]),(0,o.bF)(v,{modelValue:e.khl.soTienCODvePaypost,"onUpdate:modelValue":n[17]||(n[17]=n=>e.khl.soTienCODvePaypost=n),label:"Số tiền COD về Paypost",dense:e.dense},{after:(0,o.k6)((()=>[(0,o.bF)(b,{round:"",dense:"",flat:"",icon:"send",onClick:n[16]||(n[16]=n=>e.updateKHL(e.khl))})])),_:1},8,["modelValue","dense"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}a(4748);var k=a(6306),C=a.n(k),b=a(1627),y=a(8018);const D=(0,o.pM)({components:{ListHeader:y.A},name:"KHLPage",data(){const[e,n,a]=(new Date).toISOString().slice(0,10).split("-");return{ngayLamViec:[e,n,a].join("/"),showDialog:!1,showSelectedItems:!1,ngay:a,thang:n,nam:e,searchText:[n,e].join("/"),tokenFe:"",dsDonHang:[],khls:[],tongSoBuuGui:0,doanhThu:0,tongCuocDaThanhToan:0,khl:{hoTen:"Nguyễn Văn Thìn",soDienThoai:"0978333963",hopDong:"Mlinh-191022-622000",ngayHopDong:"2022/10/19",soTienCODvePaypost:4e6,soTienBuTruCongNo:77500,soTienDaTruCongNo:0,tenNguoiHuong:"Nguyễn Văn Thìn",soTaiKhoanNganHang:"1618081988",tenNganHang:"MB",maCRM:"14200A04000622000"},selectItems:[],cods:[],allCods:[]}},methods:{sleep(){return new Promise((e=>setTimeout(e,1500)))},async login(){var e=JSON.stringify({username:"142010_THAMHT",password:"Abc@123456789",ip:"",random:.8677049060452371}),n={method:"post",maxBodyLength:1/0,url:"https://api-portalkhl.vnpost.vn/api/auth/signinKhl",headers:{capikey:"19001235","Content-Type":"application/json"},data:e};const{data:{tokenFe:a}}=await C().post("https://api-portalkhl.vnpost.vn/api/auth/signinKhl",e,n);this.tokenFe=a},async loadData(e=0){this.dsDonHang=[],this.tokenFe||await this.login();var n=JSON.stringify({orgCode:"142010",tuNgay:[1,parseInt(this.thang-e||12),this.nam].join("/"),denNgay:new Date(this.nam,parseInt(this.thang-e),1).toISOString().slice(0,10).split("-").reverse().join("/"),pageNum:0,pageSize:5e3,sourceSystem:"KHL"}),a={method:"post",maxBodyLength:1/0,url:"https://api-portalkhl.vnpost.vn/khl/getItemDtl",headers:{Authorization:`Bearer ${this.tokenFe}`,"Content-Type":"application/json"},data:n};const{data:[o,t]}=await C()(a);this.tongSoBuuGui=o,this.doanhThu=t.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0),this.dsDonHang=t;const s=new Map,l=t.map((({senderPhone:e,senderName:n,senderAdd:a})=>({senderPhone:e,senderName:n,senderAdd:a})));for(let i=0;i<l.length;i++){const e=l[i];if(!s.has(e.senderPhone)){const n=t.filter((n=>n.senderPhone===e.senderPhone));s.set(e.senderPhone,{...e,soLuong:n.length,tongCuoc:n.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0),tongCOD:n.filter((e=>e.codAmount)).reduce(((e,{codAmount:n})=>e+parseInt(n)),0),soTienDaTruCongNo:this.tongSoTienBuTruCongNoDaTru(e.senderPhone),soTienDaChiCOD:this.tongSoTienDaChiCOD(e.senderPhone)})}}this.khls=[...s.values()]},async traCuu(){const[e,n]=this.searchText.split("/");this.thang=e,this.nam=n,this.loadData()},async findItems(e){return this.dsDonHang.filter((n=>n.senderPhone===e))},async tongCuoc(e){return e.reduce(((e,{totalFeeSpecial:n})=>e+parseInt(n)),0)},async tongSoTienBuTruCongNo(e){const n=await this.tongCuoc(await this.findItems(e))-this.cods.reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0);return parseInt(n).toLocaleString()},tongSoTienBuTruCongNoDaTru(e){const n=this.allCods.filter((n=>n.soDienThoai==e)).reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0);return n},tongSoTienDaChiCOD(e){const n=this.allCods.filter((n=>n.soDienThoai==e)).reduce(((e,{soTienCODvePaypost:n})=>e+parseInt(n)),0);return n},async updateKHL({soDienThoai:e,hoTen:n,hopDong:a,ngayHopDong:o,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:l,maCRM:i,soTienCODvePaypost:h,soTienBuTruCongNo:d}){try{const{data:u}=await this.$api.post("https://app.hotham.vn/api/cods",{soDienThoai:e,hoTen:n,hopDong:a,ngayHopDong:o,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:l,maCRM:i,soTienCODvePaypost:h.replaceAll(".",""),soTienBuTruCongNo:d.replaceAll(".",""),ngayLamViec:this.ngayLamViec}),r=this.cods.find((n=>n.soDienThoai===e&&new Date(n.ngayLamViec).toISOString().slice(0,10)===(new Date).toISOString().slice(0,10)));r?Object.assign(r,u):this.allCods.push(u),await this.$api.put(`https://app.hotham.vn/api/khls/${e}`,{hoTen:n,hopDong:a,ngayHopDong:o,tenNguoiHuong:t,soTaiKhoanNganHang:s,tenNganHang:l,maCRM:i}),this.showDialog=!1,b.A.create({type:"positive",message:"Đã ghi nhận thành công!"})}catch(u){b.A.create({type:"negative",message:"Không lưu được thông tin khách hàng!"+err})}},async loadKHL(e){try{const{data:n}=await this.$api.get(`https://app.hotham.vn/api/khls/${e}`);this.khl=n}catch(n){b.A.create({type:"negative",message:"Lỗi hệ thống!"+err})}},async loadCods(e){try{const{data:n}=await this.$api.get(`https://app.hotham.vn/api/cods?name=${e}`);this.cods=n}catch(n){b.A.create({type:"negative",message:"Lỗi hệ thống!"+err})}},async loadAllCods(){const{data:e}=await this.$api.get("https://app.hotham.vn/api/cods");this.allCods=e,this.tongCuocDaThanhToan=this.allCods.reduce(((e,{soTienBuTruCongNo:n})=>e+parseInt(n)),0)},async showKHL(e){await this.loadCods(e),await this.loadKHL(e),this.khl.soTienBuTruCongNo=await this.tongSoTienBuTruCongNo(e);const n=this.cods.find((n=>n.soDienThoai===e&&new Date(n.ngayLamViec).toISOString().slice(0,10)===(new Date).toISOString().slice(0,10)));n&&(this.khl.soTienCODvePaypost=parseInt(n.soTienCODvePaypost).toLocaleString(),this.khl.soTienBuTruCongNo=parseInt(n.soTienBuTruCongNo).toLocaleString()),this.showDialog=!0},async showItems(e){await this.loadKHL(e),this.selectItems=this.dsDonHang.filter((n=>n.senderPhone===e)),this.showSelectedItems=!0},copyTextToClipboard(e){navigator.clipboard.writeText(`Để theo dõi định vị bưu gửi https://www.hotham.vn/tra-cuu-hang-buu-dien?q=${e}. (Bạn chỉ cần bấm vào link)`).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},copySoDienThoaiToClipboard(){navigator.clipboard.writeText(this.khls.map((({senderName:e,senderPhone:n})=>`${e}\t${n}`)).join("\t\n")).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},copyTextDienThoaiToClipboard(e){navigator.clipboard.writeText(e).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},async copyChiCODToClipboard(){await this.loadAllCods(),navigator.clipboard.writeText(`${this.allCods.filter((e=>new Date(e.ngayLamViec).toISOString().slice(0,10)===(new Date).toISOString().slice(0,10))).map((({hoTen:e,hopDong:n,ngayHopDong:a,soTienCODvePaypost:o,soTienBuTruCongNo:t,tenNguoiHuong:s,soTaiKhoanNganHang:l,tenNganHang:i,maCRM:h})=>[e,n,a,o,t,o-t,s,l,i,,h].join("\t"))).join("\r\n")}\n`).then((function(){b.A.create({type:"positive",message:"Bạn đã sao chép thành công!"})}),(function(e){b.A.create({type:"negative",message:"Không thực hiện được!"+e})}))},async khoiTao(){await this.loadAllCods(),this.ngay<3?(await this.loadData(1),this.searchText=[this.thang-1||12,this.nam].join("/")):await this.loadData()}},mounted(){this.khoiTao()}});var v=a(2807),f=a(1693),F=a(9270),_=a(492),N=a(8975),S=a(8670),w=a(3999),L=a(7743),H=a(5173),I=a(3796),V=a(3954),A=a(386),O=a(2156),P=a(3316),B=a(4189),K=a(2669),x=a(8672),q=a(8582),W=a.n(q);const $=(0,v.A)(D,[["render",T]]),Q=$;W()(D,"components",{QBtn:f.A,QInput:F.A,QIcon:_.A,QPopupProxy:N.A,QDate:S.A,QList:w.A,QItem:L.A,QItemSection:H.A,QItemLabel:I.A,QBadge:V.A,QSeparator:A.A,QDialog:O.A,QCard:P.A,QCardSection:B.A,QCardActions:K.A}),W()(D,"directives",{ClosePopup:x.A})}}]);