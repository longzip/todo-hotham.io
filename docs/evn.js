const resetCong=()=>{localStorage.setItem("tongcong",JSON.stringify({tongCong:0,soHoaDon:[]})),document.getElementById("lbl_tien").textContent=0,document.getElementById("btn-minus").textContent="Cộng:",document.getElementById("txt_customer_value").value=""},luuVi=()=>{localStorage.setItem("ourarraykey",JSON.stringify(parseInt($("#wallet-current-balance").text().replaceAll(".",""))))},saveWallet=()=>{luuVi(),resetCong(),document.getElementById("btn-save").disabled=!0};let tongTien=0;const daThanhToan=()=>Math.round((parseInt(localStorage.getItem("ourarraykey"))-parseInt($("#wallet-current-balance").text().replaceAll(".","")))/1e3+.4),showWallet=()=>{const t=document.getElementById("lbl_tien");t.textContent=t.textContent+` = ${daThanhToan()}`},unLock=()=>{document.getElementById("btn-save").disabled=!1,luuVi(),resetCong()},tienThua=()=>parseInt(document.getElementById("txt_tien_value").value)-daThanhToan(),tienTra=()=>Math.floor((1e3*parseInt(document.getElementById("txt_tien_value").value)-parseInt($("#total-amount").text().replaceAll(".","")))/1e3),traLai=()=>{!1===document.getElementById("btn-save").disabled?alert("Trả lại: "+tienTra()):alert("Trả lại: "+tienThua())},readEvn=async()=>({ma:document.getElementById("customer-code").textContent,ten:document.getElementById("customer-name").textContent,soDienThoai:document.getElementById("customer-phone").textContent,diaChi:document.getElementById("customer-address").textContent,soTien:document.getElementById("total-amount").textContent.replaceAll(".",""),ghiChu:document.getElementById("depositor_note").value}),doCopy=async()=>{const t=await readEvn();document.getElementById("depositor_name").value=t.ten,document.getElementById("depositor_address").value=t.diaChi;let{soHoaDon:e,tongCong:n}=JSON.parse(localStorage.getItem("tongcong"));t.ma&&!e.includes(t.ma)&&(n+=parseInt(t.soTien),e.push(t.ma),localStorage.setItem("tongcong",JSON.stringify({tongCong:n,soHoaDon:e})),document.getElementById("lbl_tien").textContent=n.toLocaleString(),document.getElementById("btn-minus").textContent=`Cộng ${e.length}:`,document.getElementById("txt_customer_value").value=""),t.ma&&$.ajax({url:"https://evn-buudienxatulap.herokuapp.com/api/evns",type:"POST",async:!0,data:t})};function drawPrintEVN(t){let e=JSON.parse('{"CNBENTRE":{"logo":"https://static.paysmart.com.vn/billing/15.%20Bien_nhan_Cap_Nuoc_Ben_Tre.jpg","name":"Nước Bến Tre","type":"WACO","phone":"","district_id":"","iconUrl":"https://static.paysmart.com.vn/billing/icon-water/Water_Ben_Tre@3x.png","default":"true","province_id":"83","active":"true","service_code":"water","provider_code":"CNBENTRE"},"CNTHOTNOT":{"logo":"https://dev-stc.paysmart.com.vn/billing/12.%20Bien_nhan_Cap_Nuoc_Can_Tho_2.jpg","name":"Nước Thốt Nốt","type":"WACO","phone":"","district_id":"","iconUrl":"https://dev-stc.paysmart.com.vn/billing/icon-water/Water_ThotNot_CT@3x.png","default":"false","province_id":"92","active":"true","service_code":"water","provider_code":"CNTHOTNOT"},"CNCT":{"logo":"https://static.paysmart.com.vn/billing/11.%20Bien_Nhan_Cap_Nuoc_Can_Tho.png","name":"Nước Cần Thơ","type":"WACO","phone":"","district_id":"","iconUrl":"https://static.paysmart.com.vn/billing/icon-water/Water_Can_Tho@3x.png","default":"true","province_id":"92","active":"true","service_code":"water","provider_code":"CNCT"},"CNCAIRANG":{"logo":"https://dev-stc.paysmart.com.vn/billing/12.%20Bien_nhan_Cap_Nuoc_Can_Tho_2.jpg","name":"Nước Cái Răng","type":"WACO","phone":"","district_id":"","iconUrl":"https://dev-stc.paysmart.com.vn/billing/icon-water/Water_Cai_Rang_CT@3x.png","default":"false","province_id":"92","active":"true","service_code":"water","provider_code":"CNCAIRANG"},"CNTRANOC":{"logo":"https://dev-stc.paysmart.com.vn/billing/21.%20Bien_nhan_Cap_Nuoc_Tra_Noc_O_Mon.jpg","name":"Nước Trà Nóc - Ô Môn","type":"WACO","phone":"","district_id":"","iconUrl":"https://dev-stc.paysmart.com.vn/billing/icon-water/Water_Tra_Noc%403x.png","default":"false","province_id":"92","active":"true","service_code":"water","provider_code":"CNTRANOC"},"EVNS":{"logo":"https://static.paysmart.com.vn/icon/EVNSPC.png","name":"EVN Miền Nam","type":"EVN","phone":"","default":"true","district_id":"","province_id":"60","service_code":"electric","provider_code":"EVNS"},"EVNHN":{"logo":"https://dev-stc.paysmart.com.vn/billing/dien-evnhn.jpg","name":"EVN Hà Nội","type":"EVN","phone":"","district_id":"","iconUrl":"https://dev-stc.paysmart.com.vn/icon/EVNHN.png","default":"true","province_id":"01","active":"true","service_code":"electric","provider_code":"EVNHN"},"CNCANTHO2":{"logo":"https://static.paysmart.com.vn/billing/12.%20Bien_nhan_Cap_Nuoc_Can_Tho_2.jpg","name":"Nước Cần Thơ 2","type":"WACO","phone":"","district_id":"","iconUrl":"https://static.paysmart.com.vn/billing/icon-water/Water_Can_Tho2@3x.png","default":"false","province_id":"92","active":"true","service_code":"water","provider_code":"CNCANTHO2"}}'),n=$("<div />"),a=t.bills;for(let i in a){let o=a[i],d=o.billDetail||{},l={start_date:formatDataEmpty(d.startDate),end_date:formatDataEmpty(d.endDate),provider_logo:e[t.provider_code].iconUrl,customer_name:formatDataEmpty(t.customer_name),customer_address:formatDataEmpty(t.customer_address),customer_code:formatDataEmpty(t.customer_code),capacity_no:formatDataEmpty(d.kwhNo),home_no:formatDataEmpty(d.homeNo),serial_number:formatDataEmpty(d.serialNumber),bill_id:formatDataEmpty(o.billId),payment_method:formatDataEmpty(d.paymentMethod),period:formatDataEmpty(o.period),content_start_date:formatDataEmpty(d.startDate),content_end_date:formatDataEmpty(d.endDate),start_stage_no:formatDataEmpty(d.startStageNo),end_stage_no:formatDataEmpty(d.endStageNo),price_DNTT:d.priceDNTT?d.priceDNTT.replace(/;/g,"\n"):"\n",price_detail:formatNumberArray(d.priceDetail),amount_detail:formatNumberArray(d.amountDetail),total_capacity_no:formatDataEmpty(d.capacityNo),debt_amount:formatNumber(d.debtAmount),debt_fee:formatNumber(d.debtFee),amount:formatNumber(o.amount),amount_text:DOCSO().doc(o.amount)+" đồng chẵn"},s=$("<div />").append($("#bill-template-evn-1").html());Object.keys(l).forEach(((t,e)=>{"img"===s.find("#"+t).prop("tagName").toLowerCase()?s.find("#"+t).prop("src",l[t]):s.find("#"+t).hasClass("price_DNTT")||s.find("#"+t).hasClass("price_detail")||s.find("#"+t).hasClass("amount_detail")?s.find("#"+t).empty().html(l[t]):s.find("#"+t).empty().text(l[t])})),i>0&&n.append($("<div style='page-break-before: always;'></div>")),n.append(s.clone())}n.print({globalStyles:!1,stylesheet:"https://app.buudienxatulap.ga/printv2.css"})}function sleep(t){return new Promise((e=>setTimeout(e,t)))}const khoiTao=async()=>{await sleep(1e3);const t=$('<input type="text" id="txt_tien_value" name="txt_tien_value" required="" data-parsley-trigger="change" data-parsley-length="[1,100]">'),e=$('<button class="btn btn-info" type="button" onclick="saveWallet()" id="btn-save" disabled = true><i class="fa fa-save"></i> Lưu HĐ</button>'),n=$('<button class="btn btn-primary" type="button" onclick="showWallet()" id="btn-eye"><i class="fa fa-eye"></i> Xem</button>'),a=$('<button class="btn btn-success" type="button" onclick="unLock()" id="btn-lock"><i class="fa fa-lock"></i> Mở</button>'),i=$('<button class="btn btn-secondary" type="button" onclick="traLai()" id="btn-minus">Cộng</button>'),o=$('<button class="btn btn-primary" type="button" onclick="doCopy()" id="btn-copy"><i class="fa fa-copy"></i> Copy</button>'),d=$('<span id="lbl_tien" style="font-size: 28px; font-weight: 900;">0</span>');$("#wallet-current-balance").parent().append(e),$("#wallet-current-balance").parent().append(n),$("#wallet-current-balance").parent().append(a),$("#wallet-current-balance").parent().append(t),$("#wallet-current-balance").parent().append(i),$("#wallet-current-balance").parent().append(d),$("#btn-reset").parent().before(o),await sleep(1e3),$("#bill-template-evn-1").html('\n    <div class="bill-container" style="font-size: 13px;">\n    <section class="top row">\n        <div class="col-3">\n            <div class="logo" style="margin: 5px;">\n                <img src="/resources/assets/images/logo_vietnam_post.png" width="70px" height="70px">\n            </div>\n        </div>\n        <div class="col-6" style="padding-top: 5px;font-size: 17px;">\n            <div style="text-align: center">\n                <b>HỒ THỊ THẮM: BƯU ĐIỆN XÃ TỰ LẬP THU HỘ TIỀN ĐIỆN</b>\n            </div>\n            <div style="text-align: center;padding-top: 10px;font-size: 15px;">\n                (từ <span id="start_date">20/04/2019</span> đến <span id="end_date">20/04/2019</span>)<br>\n                Hồ Thị Thắm làm ở bưu điện xã Tự Lập từ tháng 8.2021.\n            </div>\n        </div>\n        <div class="col-3">\n            <div class="logo" style="margin: 5px;float: right;">\n                <img id="provider_logo" src="/resources/assets/images/logo_vietnam_post.png" width="70px" height="70px">\n            </div>\n        </div>\n    </section>\n\n    <section class="customer-info row">\n        <div class="left col-6">\n            <div style="margin: 5px;">\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Tên KH:\n                    </div>\n                    <div style="font-weight: bold;" id="customer_name">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: flex-start">\n                    <div style="min-width: -moz-max-content;min-width: max-content;">\n                        Địa chỉ:\n                    </div>\n                    <div style="font-weight: bold;" id="customer_address">\n                        379 PHUNG SON A TAN LONG PH PG\n                    </div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Mã KH:\n                    </div>\n                    <div style="font-weight: bold;" id="customer_code">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Số công tơ:\n                    </div>\n                    <div style="font-weight: bold;" id="capacity_no">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Số hộ:\n                    </div>\n                    <div style="font-weight: bold;" id="home_no">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Seri HĐĐT:\n                    </div>\n                    <div style="font-weight: bold;" id="serial_number">BUI ANH TRUNG</div>\n                </div>\n            </div>\n        </div>\n        <div class="left col-6">\n            <div style="margin: 5px;">\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        ID hóa đơn:\n                    </div>\n                    <div style="font-weight: bold;" id="bill_id">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        Hình thức thanh toán:\n                    </div>\n                    <div style="font-weight: bold;" id="payment_method">379 PHUNG SON A TAN LONG PH PG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: start">\n                    <div style="min-width: -moz-max-content;min-width: max-content;">\n                        Nội dung:\n                    </div>\n                    <div style="font-weight: bold;word-wrap: break-word;">Thanh toán hóa đơn tiền điện kỳ <span id="period">20/04/2019</span> từ ngày <span id="content_start_date">20/04/2019</span> đến ngày <span id="content_end_date">20/04/2019</span></div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        CSĐK:\n                    </div>\n                    <div style="font-weight: bold;" id="start_stage_no">BUI ANH TRUNG</div>\n                </div>\n                <div class="item" style="display: flex;align-items: center">\n                    <div>\n                        CSCK:\n                    </div>\n                    <div style="font-weight: bold;" id="end_stage_no">BUI ANH TRUNG</div>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class="signature-evn row">\n        <div class="col-12">\n            <table style="width: 100%;">\n                <colgroup>\n                    <col width="30%">\n                    <col width="30%">\n                    <col width="40%">\n                </colgroup>\n                <tr>\n                    <th>ĐNTT</th>\n                    <th>Đơn giá (VND)</th>\n                    <th>Thành tiền (VND)</th>\n                </tr>\n                <tr>\n                    <td style="text-align: right; padding-right: 5px;"><div id="price_DNTT" style="white-space: pre-line;"></div></td>\n                    <td style="text-align: right; padding-right: 5px;"><div id="price_detail" style="white-space: pre-line;"></div></td>\n                    <td style="text-align: right; padding-right: 5px;"><div id="amount_detail" style="white-space: pre-line;"></div></td>\n                </tr>\n                <tr>\n                    <td id="total_capacity_no" style="text-align: right; padding-right: 5px;"></td>\n                    <td></td>\n                    <td id="debt_amount" style="text-align: right; padding-right: 5px;"></td>\n                </tr>\n                <tr>\n                    <th colspan="2" style="text-align: left; padding-left: 5px;">\n                        Thuế GTGT\n                    </th>\n                    <td id="debt_fee" style="text-align: right; padding-right: 5px;"></td>\n                </tr>\n                <tr>\n                    <th colspan="2" style="text-align: left; padding-left: 5px;">\n                        Số tiền thanh toán\n                    </th>\n                    <td id="amount" style="text-align: right; padding-right: 5px;"></td>\n                </tr>\n                <tr>\n                    <td colspan="3" style="text-align: left; padding-left: 5px;">\n                        <span style="font-weight: bold;">Số tiền bằng chữ: </span><span id="amount_text"></span>\n                    </td>\n\n                </tr>\n                <tr>\n                    <td colspan="3" style="text-align: left; padding-left: 5px;">\n                        <span style="font-weight: bold;">P/s: </span>Khi cần cấp, đổi thẻ BHYT hết hạn hãy đến trực tiếp Bưu điện VHX Tự Lập hoặc gọi 0978333963 để được đảm bảo quyền lại khám chữa bệnh BHYT. Từ nhà bạn đến chúng tôi ngắn hơn đấy!</span>\n                    </td>\n\n                </tr>\n            </table>\n        </div>\n    </section>\n\n</div>\n    ');try{document.getElementById("txt_tien_value").addEventListener("keydown",(function(t){13==t.keyCode&&traLai()}),!0)}catch(l){}};khoiTao();